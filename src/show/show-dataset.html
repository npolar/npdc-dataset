<!DOCTYPE html>
<npdc:edit-button class="np-primary-control"></npdc:edit-button>
<npdc:loader ng-if="!document"></npdc:loader>
<div ng-if="document">
  
  <leaflet ng-if="document && mapOptions.coverage" options="mapOptions" class="coverage-map"></leaflet>
   
  <md-card>
    <md-card-content>
      <header>
        <h1 class="md-display-2" title="{{ uri }}">{{ document.title }} {{ document.version ? '['+document.version+']' : ''}}</h1>
            
        <h2 class="md-headline"><npdc:authors authors="authors"></npdc:authors></h2>

        <span ng-if="publisher">{{ 'Dataset' | t }} {{ 'published'|t }} {{ document.released.split('T')[0] }} {{ 'by'|t }}
          <a ng-href="{{publisher.homepage}}"><md-tooltip>{{'publisher'|t}}</md-tooltip>{{ publisher.name | t }}</a>  
        </span>
        
        <nav>
          <p>
            <span ng-repeat="s in sections">
              <a ng-href="{{resource.href(document.id)}}#{{s}}">{{ 'id.'+s | t }}</a><span ng-if="!$last"> |</span>
            </span>
          </p>
        </nav>
      </header>
      
    </md-card-content>
  </md-card>
  
  <md-card id="id">
    <md-card-content>
    
      <p>
        <a ng-if="document.doi" ng-href="//doi.org/{{document.doi}}" ><img src="/assets/img/doi.png" height="20px" alt="DOI"><md-tooltip>Digital Object Identifier</md-tooltip>{{ document.doi}}</a>
        <span ng-if="!document.doi">URI: <a ng-href="{{ uri }}">{{ uri }}</a><md-tooltip md-direction="left">URI (persistent web address)</md-tooltip></span>
      </p>
      <npdc:citation citations="citations"></npdc:citation>

    </md-card-content>
  </md-card>
    
  <md-card id="data" ng-if="isReleased && data.length > 0">
    <md-card-header>
      <md-card-avatar>
        <md-icon>file_download</md-icon>
      </md-card-avatar>
      <md-card-header-text>
        <span class="md-headline">Data</span>
        <span class="md-subhead">Files and data services</span>
      </md-card-header-text>
    </md-card-header>
    <md-card-content>
      <table><tr ng-repeat="link in data">
        <td><span><code><a target="_blank" rel="nofollow" title="{{ link.title }} ({{ link.type}})" ng-href="{{link.href}}">{{ link.filename || link.title || link.href }}</a></code></span></td>
        <td><code title="{{ link.type }}">{{ link.length | bytes }}</code></td> 
       </tr>
      </table>
      <npdc:licences licences="document.licences" license=""></npdc:licences> <!-- {{ document.licences[0] | json }}  -->
      
    </md-card-content>
  </md-card>
        
  <section class="np-padding" id="text">
    <p class="markdown" marked="document.summary"></p>
    <p class="markdown" marked="document.quality"></p>
    <p class="markdown" marked="document.comment"></p>
  </section>

  <md-card id="links" ng-if="related.length > 0">
    <md-card-header>
      <md-card-avatar>
        <md-icon>subdirectory_arrow_right</md-icon>
      </md-card-avatar>
      <md-card-header-text>
        <span class="md-headline">{{ 'Links' | t }}</span>
        <span class="md-subhead">
        </span>
      </md-card-header-text>
    </md-card-header>
    <md-card-content>
      <span ng-repeat="link in related">
        <span ng-if="link.rel != 'related'">{{ link.rel | t  }}: </span><a ng-href="{{link.href}}" title="{{link.title}}">{{ link.title }}</a>
        <span ng-if="!$last">|</span>
      </span>
    </md-card-content>
  </md-card>
      
  <md-card ng-if="document.coverage" id="coverage">
    <md-card-header>
      <md-card-avatar>
        <md-icon>language</md-icon>
      </md-card-avatar>
      <md-card-header-text>
        <span class="md-headline">Coverage</span>
        <span class="md-subhead">
          Geographic and temporal extent
        </span>
      </md-card-header-text>
    </md-card-header>    
    <md-card-content>
      <p ng-if="bboxes.length" class="md-subhead" title="Bounding box">Bbox: <span ng-repeat="bbox in bboxes"><span title="W: {{bbox[0]}}, S: {{bbox[1]}}, E: {{bbox[2]}}, N: {{bbox[3]}}">{{ bbox|json }}</span></span></p>
      <p ng-if="datespans.length" class="md-subhead">Timespan: <span ng-repeat="t in datespans">[{{ t[0] }} - {{t[1]}}] </span> </p>
      <p ng-if="document.placenames" class="md-subhead">
        {{ 'Placenames'|t }}:
        <span ng-repeat="p in document.placenames">
          <a ng-href="http://placenames.npolar.no/stadnamn/?q={{ p.placename || p.area }}">{{ p.placename || p.area }}</a>
          <span ng-if="!$last">|</span>
        </span>
      </p>
    </md-card-content>
  </md-card>
     
  <div ng-if="images" layout-padding class="np-layout-grid" id="images">
 <!--     <md-grid-list
          md-cols="1"
          md-cols-md="1"
          md-cols-gt-md="1"
          md-row-height="1:1"
          md-gutter="8px">-->
          <md-grid-tile ng-repeat="i in images">
              <div>
                  <a ng-href="{{ i.href }}"><img alt="{{ i.title}}" title="{{ i.title }}" ng-src="{{ i.href }}" width="95%"></a>
              </div>
              <md-grid-tile-footer>
                  <h3>{{ img.title(map) }}</h3>
              </md-grid-tile-footer>
          </md-grid-tile>
       <!-- </md-grid-list>-->

  </div>

  <md-card id="people">
    <md-card-header>
      <md-card-avatar>
        <md-icon>person</md-icon>
      </md-card-avatar>
      <md-card-header-text>
        <span class="md-headline">{{'People' | t}}</span>
        <span class="md-subhead"></span>
      </md-card-header-text>
    </md-card-header>
    <md-card-content>
      <p ng-repeat="p in document.people">
        
        <span id="{{ p.first_name | lowercase }}+{{ p.last_name | lowercase}}">
          
          {{ p.first_name}} {{ p.last_name}}
        </span>
        
        <span ng-if="p.organisation">({{ (p.organisation) }})</span>
        <i ng-repeat="r in p.roles">{{ r | t }}<span ng-if="!$last">, </span></i>
        
        <a ng-if="p.homepage" ng-href="{{p.homepage}}"><md-icon alt="Homepage">home</md-icon><md-tooltip>{{'Homepage'}}: {{p.homepage}}</md-tooltip></a>
        <a ng-if="p.email && isPointOfContact(p)" ng-href="mailto:{{p.email}}"><md-icon>email</md-icon></a>
        <!-- todo nice menu <md-button ng-href="{{resource.uiBase}}?q={{ p.name }}&filter-people.last_name={{p.last_name}}">{{ 'Search' }}</md-button>-->
  
      </p>
    </md-card-content>
  </md-card>
        
  <md-card id="organisations">
    <md-card-header>
      <md-card-avatar>
        <md-icon>business</md-icon>
      </md-card-avatar>
      <md-card-header-text>
        <span class="md-headline">{{'Organisations' | t}}</span>
        <span class="md-subhead"></span>
      </md-card-header-text>
    </md-card-header>
    <md-card-content id="classification">
      <span class="md-subhead">
      <md-list>
        <md-list-item class="md-1-line" ng-repeat="o in document.organisations">
         
          <div class="md-list-item-text">
            <span>{{ (o.name) | t }} ({{ o.id }})</span>
            
            <i ng-repeat="r in o.roles">{{ r | t }}<span ng-if="!$last">, </span></i>
            
            <a ng-if="o.homepage" ng-href="{{o.homepage}}"><md-icon>home</md-icon><md-tooltip>{{'Homepage'}}: {{o.homepage}}</md-tooltip></a>
            <!-- @todo create nice menu --><!--<md-button ng-href="{{resource.uiBase}}?q={{ (o.id || o.name|t) }}">{{ 'Search' }}</md-button>-->
          </div>
        </md-list-item>
      </md-list>
      </span>
      <span id="classification"></span>
    </md-card-content>
  </md-card>
   
  <md-card ng-if="document.topics || document.iso_topics || document.sets || document.tags || document.gcmd.sciencekeywords" id="classification">
    <md-card-header>
      <md-card-avatar>
        <md-icon>label_outline</md-icon>
      </md-card-avatar>
      <md-card-header-text>
        <span class="md-headline">{{ 'Classification'|t }}</span>
        <span class="md-subhead">Sets, topics, GCMD keywords</span>
      </md-card-header-text>
    </md-card-header>
    <md-card-content>
      <span ng-repeat="set in document.sets">
            <a ng-href="{{resource.uiBase}}?q=&filter-sets={{set}}">{{ set|t }}</a>{{!$last ? '':''}}
          </span>
          <span ng-repeat="topic in document.topics">
            <a ng-href="?q=&filter-topics={{topic}}">{{ topic|t }}</a>{{!$last ? '':''}}
          </span>
          <span ng-repeat="iso_topic in document.iso_topics">
            <a ng-href="?q=&filter-iso_topics={{iso_topic}}">{{ iso_topic | t }}</a>{{!$last ? '':''}}
          </span>
          <span ng-repeat="tag in document.tags">
            <a ng-href="?q=&filter-tags={{tag}}">{{ tag|t }}</a>{{!$last ? '':''}}
          </span>
        
          <!--<span class="md-headline">NASA GCMD Science Keywords</span>-->
          <span ng-if="document.gcmd.sciencekeywords" class="md-subhead">
            <span ng-repeat="k in document.gcmd.sciencekeywords">
              <!--<md-icon>label_outline</md-icon>-->
              <!--<a href="?q={{ k.Category}}">{{ k.Category}}</a>-->
              <a href="?q={{ k.Topic}}">{{ k.Topic.toLowerCase() }}</a>
              <a href="?q=filter.gcmd.sciencekeywords.Term={{ k.Term }}">{{ k.Term.toLowerCase() }}</a>
              <a ng-show="k.Variable_Level_1" href="?q=&filter-Variable_Level_1={{ k.Variable_Level_1}}">{{ k.Variable_Level_1.toLowerCase() }}</a>
              <a ng-show="k.Variable_Level_2" href="?q=&filter-Variable_Level_2={{ k.Variable_Level_2}}">{{ k.Variable_Level_2.toLowerCase() }}</a>
            </span>
          </span>
    </md-card-content>
  </md-card>
        
  <md-card ng-if="relations.length > 0" id="relations">
    <md-card-header>
      <md-card-avatar>
        <md-icon>compare_arrows</md-icon>
      </md-card-avatar>
      <md-card-header-text>
        <span class="md-headline">Relations</span>
        <span class="md-subhead"> </span>
      </md-card-header-text>
    </md-card-header>
    <md-card-content>
      <span ng-repeat="link in relations">
        <span ng-if="link.rel != 'related'">{{ link.rel | t  }}: </span><a ng-href="{{link.href}}" title="{{link.title}}">{{ link.title }}</a>
        <span ng-if="!$last">|</span>
      </span>
    </md-card-content>
  </md-card>
        
  <md-card ng-if="suggestions.length > 0" id="suggestions">
  <md-card-header>
    <md-card-avatar>
      <md-icon>account_balance</md-icon>
    </md-card-avatar>
    <md-card-header-text>
      <span class="md-headline">See also</span>
      <span class="md-subhead">Similar datasets</span>
    </md-card-header-text>
  </md-card-header>
  <md-card-content>
    <p ng-repeat="link in suggestions">
      <a ng-href="{{link.id}}" title="{{link.title}}"><span>{{link.title}}</span></a>
      [{{ link._score }}]
    </p>
  </md-card-content>
</md-card>

  <npdc:metadata id="metadata" metadata="metadata" document="document"></npdc:metadata>
</div>